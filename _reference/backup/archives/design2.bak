# ICTServe System Design

## Purpose & Scope

This document summarises the current design for ICTServe release 3.0.0, covering the Helpdesk ticketing module, ICT asset loan workflow, and the Filament-based administration panel operated by BPM MOTAC. It consolidates the core architecture decisions described in `docs/D00_SYSTEM_OVERVIEW.md`, `docs/D03_SOFTWARE_REQUIREMENTS_SPECIFICATION.md`, and `docs/D04_SOFTWARE_DESIGN_DOCUMENT.md`, ensuring traceability to the D00-D15 documentation set.

## Canonical References

- `docs/D00_SYSTEM_OVERVIEW.md` (system context and ownership)
- `docs/D02_BUSINESS_REQUIREMENTS_SPECIFICATION.md` (business capabilities)
- `docs/D03_SOFTWARE_REQUIREMENTS_SPECIFICATION.md` sections SRS-HELP, SRS-LOAN
- `docs/D04_SOFTWARE_DESIGN_DOCUMENT.md` sections 3-4
- `docs/D09_DATABASE_DOCUMENTATION.md` sections A3-A4
- `docs/D12_UI_UX_DESIGN_GUIDE.md`, `docs/D13_UI_UX_FRONTEND_FRAMEWORK.md`, `docs/D14_UI_UX_STYLE_GUIDE.md`
- `docs/testing/testing-and-quality-assurance-summary.md`
- `docs/helpdesk-system-flow.md`, `docs/asset-loan-system-flow.md`, `docs/email-notification-system.md`

## 1. System Overview

ICTServe is an internal-only web platform delivered over the MOTAC intranet, implementing a **hybrid architecture** with three distinct access tiers (Ref: Requirements 1.1, 22.1, 23.1). The design emphasises:

- **Guest submission channel:** Livewire v3 forms hosted on Laravel 12 for quick, unauthenticated access to helpdesk tickets and asset loan applications, hardened with rate limiting and invisible reCAPTCHA (Ref: `docs/D03_SOFTWARE_REQUIREMENTS_SPECIFICATION.md` section SRS-HELP-001, section SRS-LOAN-001; Requirements 1.1, 11.1, 21.1-21.5).

- **Authenticated internal portal:** Laravel Breeze/Jetstream-powered staff portal providing submission history, profile management, enhanced tracking, and optional claim of guest submissions (Ref: Requirements 1.3, 22.1-22.7, 23.3). Staff can choose between quick guest forms or comprehensive authenticated access based on their needs.

- **Admin governance:** Four-role RBAC model (`staff`, `approver`, `admin`, `superuser`) with Filament v4 panel (`/admin`) for backend operations, enforcing dual control for system configuration and audit review (Ref: `docs/D04_SOFTWARE_DESIGN_DOCUMENT.md` section 4.3; Requirements 3.2, 9.1).

- **Dual approval workflows:** Grade 41+ officers can approve asset loans via email links (no login) OR through the authenticated portal, providing flexibility while maintaining security (Ref: Requirements 1.6, 12.1-12.5, 23.2).

- **Unified operational services:** Queue-driven notifications, immutable audit trails, and shared component libraries compliant with WCAG 2.2 AA and MyGOV DSS 2.1.0 (Ref: `docs/D12_UI_UX_DESIGN_GUIDE.md`, `docs/D14_UI_UX_STYLE_GUIDE.md`; Requirements 5.1, 14.3).

## 2. Architecture Summary

### 2.1 Logical Layers

| Layer | Components | Notes |
|-------|------------|-------|
| Presentation - Guest | Livewire guest forms (`helpdesk.ticket-form`, `loan.application-form`), Blade layout `guest.blade.php` | No authentication required; accessibility enforced per `docs/D12_UI_UX_DESIGN_GUIDE.md` section 4 (Ref: Requirements 1.1, 11.1, 21.1) |
| Presentation - Authenticated Portal | Laravel Breeze/Jetstream auth, staff dashboard, submission history, profile management, internal comments | Login required for staff; provides enhanced features (Ref: Requirements 1.3, 22.1-22.7) |
| Presentation - Admin Panel | Filament v4 panel widgets, resources, dashboards for `admin` and `superuser` roles | Backend management with four-role RBAC (Ref: Requirements 3.1-3.2) |
| Application | Service classes (`HelpdeskService`, `LoanService`, `ApprovalService`, `NotificationService`), policies, observers | Encapsulates business rules and workflow orchestration (Ref: `docs/D04_SOFTWARE_DESIGN_DOCUMENT.md` section 3.1) |
| Persistence | Eloquent models (`HelpdeskTicket`, `LoanApplication`, `LoanApproval`, `Asset`, `Activity`, `User`) with database transactions | Schema defined in `docs/D09_DATABASE_DOCUMENTATION.md`; supports both guest and authenticated submissions |
| Infrastructure | Redis queues, mailers, storage (MinIO/S3), audit log exporter, signed URL helpers, session/cookie language persistence | Supports asynchronous notifications, status tracking, and guest language preferences (Ref: Requirements 10.1-10.2, 20.1-20.5) |
| Security & Compliance | Middleware (`guest.throttle`, `auth`, `signed`), reCAPTCHA, PDPA-aligned data handling, WCAG testing pipelines, four-role RBAC | Control set mapped in `docs/D02_BUSINESS_REQUIREMENTS_SPECIFICATION.md` section NFR-SEC (Ref: Requirements 9.1-9.5) |

### 2.2 Deployment View

```mermaid
flowchart LR
    Staff["MOTAC Staff (Intranet)"] -->|HTTPS| GuestUI["Laravel 12 + Livewire Guest Forms<br/>(No Login)"]
    Staff -->|HTTPS + Auth| Portal["Authenticated Internal Portal<br/>(Breeze/Jetstream)"]
    Approver["Email Approvers<br/>(Grade 41+)"] -->|Signed Links| ApprovalUI["Email-Based Approval"]
    Approver -->|HTTPS + Auth| Portal
    GuestUI --> AppCore["Application Layer<br/>Services & Policies"]
    Portal --> AppCore
    ApprovalUI --> AppCore
    AppCore --> Filament["Filament v4 Admin Panel<br/>(staff, approver, admin, superuser)"]
    AppCore --> MySQL[(MySQL 8)]
    AppCore --> Redis[(Redis Queue + Session)]
    AppCore --> Storage["MinIO / S3 Attachments"]
    AppCore --> Mailer["SMTP / GOV Email Gateway"]
    Filament --> Audit["Activity Log Export"]
```

### 2.3 Technology Stack

| Layer | Technology | Version | Purpose |
|-------|------------|---------|---------|
| **Backend Framework** | Laravel | 12.x | Core application framework |
| **Language** | PHP | 8.2+ | Server-side programming |
| **Authentication** | Laravel Breeze/Jetstream | 2.x | Staff portal authentication |
| **Frontend Framework** | Livewire | 3.x | Dynamic UI components |
| **Single-File Components** | Volt | 1.x | Simplified component development |
| **Admin Panel** | Filament | 4.x | Administrative interface (4 roles: staff/approver/admin/superuser) |
| **Templating** | Blade | - | Server-side templating |
| **CSS Framework** | Tailwind CSS | 3.x | Utility-first styling with compliant colors |
| **Build Tool** | Vite | 4.x | Asset compilation and optimization |
| **Database** | MySQL | 8.0+ | Primary data storage |
| **Cache/Sessions** | Redis | 7.0+ | Caching and session management |
| **Queue System** | Laravel Queue | - | Background job processing |

### 2.4 Design Patterns

- **Hybrid Access Pattern**: Dual-path access supporting both guest (no login) and authenticated (login required) workflows
- **Email-First Communication**: Primary interaction through automated email workflows for both guest and authenticated users
- **Dual Approval Pattern**: Support for both email-based approvals (no login) and portal-based approvals (authenticated)
- **MVC (Model-View-Controller)**: Laravel's core architectural pattern
- **Repository Pattern**: Data access abstraction for testability
- **Service Layer Pattern**: Business logic encapsulation
- **Observer Pattern**: Event-driven notifications and audit logging
- **Strategy Pattern**: Configurable approval workflows via email and portal
- **Factory Pattern**: Model factories for testing and seeding
- **Role-Based Access Control (RBAC)**: Four-tier role system (staff, approver, admin, superuser)

## 3. WCAG 2.2 Level AA Compliance Design

### 3.1 Compliant Color Palette

The system uses a strictly compliant color palette that meets WCAG 2.2 Level AA contrast requirements:

```css
/* Primary Colors - WCAG 2.2 AA Compliant */
--motac-blue: #0056b3;        /* 6.8:1 contrast ratio */
--motac-blue-light: #3d8bfd;  /* Hover states */
--motac-blue-dark: #004085;   /* Active states */

/* Semantic Colors - WCAG 2.2 AA Compliant */
--success: #198754;           /* 4.9:1 contrast ratio */
--warning: #ff8c00;           /* 4.5:1 contrast ratio with black text */
--danger: #b50c0c;            /* 8.2:1 contrast ratio */
--info: #0dcaf0;              /* Sufficient contrast */

/* DEPRECATED - TO BE REMOVED */
/* --warning-old: #F1C40F;   /* Non-compliant - REMOVE */
/* --danger-old: #E74C3C;    /* Non-compliant - REMOVE */
```

### 3.2 Accessibility Features

1. **Focus Indicators**: 3-4px outline with 2px offset, minimum 3:1 contrast ratio
2. **Touch Targets**: Minimum 44Ã—44px for all interactive elements
3. **Typography**: Line-height 1.5, maximum 80ch width for readability
4. **Color Independence**: No information conveyed by color alone
5. **ARIA Landmarks**: Proper semantic structure with role attributes
6. **Screen Reader Support**: ARIA live regions for dynamic content
7. **Keyboard Navigation**: Full keyboard accessibility with skip links

## 4. Core Web Vitals Performance Design

### 4.1 Performance Targets

- **LCP (Largest Contentful Paint)**: < 2.5 seconds
- **FID (First Input Delay)**: < 100 milliseconds
- **CLS (Cumulative Layout Shift)**: < 0.1
- **TTFB (Time to First Byte)**: < 600 milliseconds
- **Lighthouse Performance Score**: 90+
- **Lighthouse Accessibility Score**: 100

### 4.2 Performance Optimization Strategies

1. **Image Optimization**: WebP format with JPEG fallbacks using picture elements, explicit width/height attributes to prevent CLS, critical images with fetchpriority="high", non-critical images with loading="lazy" and fetchpriority="low"
2. **Asset Optimization**: Vite build with Gzip/Brotli compression, code splitting with manual chunks for vendor/livewire, Terser minification with drop_console in production, correct TailwindCSS content paths for purging unused styles
3. **CSS Optimization**: Tailwind CSS purging with comprehensive content paths, critical CSS inlining, refactor all inline style attributes and style blocks into external CSS files
4. **JavaScript Optimization**: Code splitting with manual chunks, tree shaking, ES2020 target, remove console statements in production
5. **Caching Strategy**: Redis caching for sessions and application data, browser caching with proper headers, CDN integration for static assets
6. **Database Optimization**: Query optimization with eager loading using with(), proper indexing, N+1 query prevention with #[Computed] properties

## 5. Module Designs

### 5.1 Helpdesk Ticketing

- **Entry points:**
  - **Guest form:** `/helpdesk` Livewire form capturing submitter metadata (name, email, phone, staff_id, grade, division), issue classification, SLA priority, and attachments without authentication (Ref: `docs/D03_SOFTWARE_REQUIREMENTS_SPECIFICATION.md` section SRS-HELP-001, `docs/helpdesk-system-flow.md` section 1; Requirements 1.1-1.2, 11.1, 21.2).
  - **Authenticated portal:** Staff can view submission history, add internal comments, upload additional attachments, and track real-time status updates (Ref: Requirements 1.3, 22.2-22.3, 23.3).
- **Processing:** `HelpdeskService::createTicket()` persists tickets with unique `HD[YYYY][000001-999999]` format, moves temporary uploads into durable storage, emits notifications within 60 seconds to staff and BPM admins, and registers audit entries (Ref: `docs/D04_SOFTWARE_DESIGN_DOCUMENT.md` section 4.1; Requirements 1.2, 10.1).
- **Status lifecycle:** `OPEN -> ASSIGNED -> IN_PROGRESS -> PENDING_USER -> RESOLVED -> CLOSED`, tracked by policies and observers, with comments preserved for replay accuracy (`docs/helpdesk-system-flow.md` section 3).
- **Claiming mechanism:** Authenticated staff can claim guest submissions by verifying email ownership, linking historical guest tickets to their portal account (Ref: Requirements 1.2, 11.7, 22.6).
- **Admin actions:** Filament resource allows assignment to divisions/external agencies, SLA adjustments, and resolution logging. `admin` and `superuser` roles have override capabilities for escalations and audit review (`docs/D04_SOFTWARE_DESIGN_DOCUMENT.md` section 4.3; Requirements 3.1, 13.1-13.5).

### 5.2 ICT Asset Loan

- **Entry points:**
  - **Guest form:** `/loan` Livewire form for loan metadata (requester details, requested assets, loan period), supporting documents. Submissions generate unique request numbers and chain approvals based on division/grade rules (Ref: `docs/D03_SOFTWARE_REQUIREMENTS_SPECIFICATION.md` section SRS-LOAN-001, `docs/asset-loan-system-flow.md` section 3; Requirements 1.4, 11.1, 21.2).
  - **Authenticated portal:** Staff can view loan application history, track approval status, add comments, and manage their active loans (Ref: Requirements 22.2-22.3).
- **Dual approval workflow:**
  - **Email-based (no login):** `LoanService` and `ApprovalService` issue signed approval links (valid 7 days per Requirements 1.4, 12.2) to Grade 41+ officers via queue-backed email jobs; decisions captured in `loan_approvals` with token hashing per PDPA guidance (Ref: `docs/email-notification-system.md` section 2; Requirements 12.1-12.5).
  - **Portal-based (with login):** Approvers can also process applications through the authenticated portal with same decision capture and audit trail (Ref: Requirements 1.6, 23.2).
- **Lifecycle:** `DRAFT -> SUBMITTED -> UNDER_REVIEW -> APPROVED/REJECTED -> READY_ISSUANCE -> ISSUED -> RETURN_DUE -> RETURNED -> COMPLETED`, with automated reminders dispatched 48 hours before due dates, on due date, and daily for overdue items (`docs/asset-loan-system-flow.md` section 3; Requirements 10.4).
- **Inventory touchpoints:** Filament resources update asset availability, record issuance/return metadata, and automatically trigger maintenance tickets within 5 seconds when damage is flagged (`docs/D09_DATABASE_DOCUMENTATION.md` section A4; Requirements 2.3).

### 5.3 Filament Administration Panel

- **Four-role RBAC model:** (Ref: Requirements 3.2, 9.1, 22.5)
  - **Staff:** Authenticated portal access to view/manage own submissions only
  - **Approver:** Grade 41+ officers with approval rights for loan applications (email or portal-based)
  - **Admin:** Operational management of helpdesk tickets, asset loans, inventory, and reporting
  - **Superuser:** Full system governance including user management, role assignment, system configuration, and audit review
- **Access control:** Restricted to users with assigned roles stored in `users` table; authentication uses Laravel Breeze/Jetstream with multifactor enforcement for `superuser` accounts (Ref: `docs/D04_SOFTWARE_DESIGN_DOCUMENT.md` section 4.3, `docs/D11_TECHNICAL_DESIGN_DOCUMENTATION.md` section 6; Requirements 9.3).
- **Capabilities:**
  - Unified dashboard widgets combining helpdesk (ticket volume, resolution time, SLA compliance) and asset loan metrics (utilization rate, overdue items, approval time) with 300-second refresh (Ref: Requirements 3.5, 8.1)
  - Resource management for tickets, loan applications, assets, users, divisions, and configurations
  - Integrated reporting with CSV, PDF, Excel exports combining data from both modules (Ref: Requirements 3.6, 8.5)
  - Comprehensive audit explorers with 7-year retention and immutable logs (Ref: Requirements 3.7, 9.5)
  - `superuser` approves configuration changes per D01 section 9.3 workflow requirements and manages role assignments with audit logging (Ref: Requirements 3.4)
- **Compliance UI:** Components conform to WCAG 2.2 Level AA standards with compliant color palette (Primary #0056b3, Success #198754, Warning #ff8c00, Danger #b50c0c), keyboard navigation, and accessible data visualizations in `docs/frontend/filament-admin-interface-compliance.md` and `docs/D14_UI_UX_STYLE_GUIDE.md` (Ref: Requirements 3.3, 3.5, 18.4, 19.5).

### 5.4 Authenticated Internal Portal

- **Purpose:** Provides MOTAC staff with enhanced features beyond quick guest forms, offering comprehensive submission management and profile control (Ref: Requirements 22.1-22.7, 23.3).
- **Authentication:** Laravel Breeze/Jetstream implementation with standard email/password authentication, password reset, and email verification flows (Ref: Requirements 22.1, 9.3).
- **Core features:**
  - **Personalized dashboard:** Displays complete submission history including all helpdesk tickets and asset loan applications with real-time status tracking (Ref: Requirements 1.3, 22.2)
  - **Detailed submission views:** Staff can view full details, add internal comments, upload additional attachments, and track resolution progress for their submissions (Ref: Requirements 22.3)
  - **Profile management:** Update contact information (email, phone), preferences, and notification settings (Ref: Requirements 22.4)
  - **Guest submission claiming:** Link historical guest submissions to authenticated account by verifying email ownership (Ref: Requirements 1.2, 11.7, 22.6)
  - **Approval workflows (for approvers):** Grade 41+ officers can process loan applications through portal interface as alternative to email links (Ref: Requirements 1.6, 23.2)
- **Access control:** Role-based visibility where `staff` role can only view/edit own submissions; `approver`, `admin`, and `superuser` roles have elevated permissions (Ref: Requirements 22.5).
- **Design consistency:** Maintains WCAG 2.2 Level AA compliance, MOTAC branding with compliant color palette, bilingual support (BM/EN), and responsive design across all portal pages (Ref: Requirements 22.7, 11.3-11.4).
- **Integration:** Seamlessly integrates with guest forms (claim mechanism), email workflows (notifications), and Filament admin panel (data consistency) (Ref: Requirements 23.1, 23.6).

### 5.5 Shared Services

- **Notification Service:** Centralised queue jobs for emails and (optional) SMS gateway calls with 60-second delivery target, logging correlation IDs for audit reconciliation. Supports both guest and authenticated user notifications (`docs/email-notification-system.md` section 3; Requirements 1.2, 1.4, 10.1).
- **Audit Engine:** `spatie/laravel-activitylog` records CRUD and status changes for guest submissions, authenticated user actions, and administrative operations; exports feed BPM's SIEM pipeline with 7-year retention as defined in `docs/D09_DATABASE_DOCUMENTATION.md` section A5 (Ref: Requirements 9.2, 9.5, 23.6).
- **Status Tracking:** Optional `status_tokens` table maps guest-friendly status URLs to ticket/loan records, ensuring read-only access without authentication. Authenticated users access status through portal dashboard (`docs/D03_SOFTWARE_REQUIREMENTS_SPECIFICATION.md` section 163; Requirements 1.3, 22.2).
- **Language Persistence:** Session and cookie-based language preference storage for guest users (no database persistence), with simplified resolution priority: Session â†’ Cookie â†’ Browser â†’ Fallback (Ref: Requirements 20.1-20.5).

## 6. Components and Interfaces

### 6.1 Frontend Component Architecture

#### Component Library Structure

```
resources/views/components/
|- layouts/
|  |- guest.blade.php        # Guest layout for public forms (no authentication)
|  |- app.blade.php          # Authenticated layout for staff portal (login required)
|  |- header.blade.php       # Site header with MOTAC branding
|  |- auth-header.blade.php  # Authenticated header with user menu
|  |- footer.blade.php       # Site footer with accessibility links
|- form/
|  |- input.blade.php        # WCAG compliant input with proper labels
|  |- select.blade.php       # Accessible select with ARIA attributes
|  |- textarea.blade.php     # Accessible textarea component
|  |- checkbox.blade.php     # WCAG compliant checkbox
|  |- file-upload.blade.php  # Accessible file upload component
|- ui/
|  |- button.blade.php       # 44x44px minimum touch targets
|  |- card.blade.php         # Accessible card container
|  |- alert.blade.php        # ARIA live region alerts
|  |- badge.blade.php        # Accessible status badges
|  |- modal.blade.php        # Focus trap modal dialogs
|- navigation/
|  |- breadcrumbs.blade.php  # Accessible breadcrumb navigation
|  |- pagination.blade.php   # WCAG compliant pagination
|  |- skip-links.blade.php   # Skip navigation for keyboard users
|- data/
|  |- table.blade.php        # Accessible data tables
|  |- status-badge.blade.php # Color + icon + text status indicators
|  |- progress-bar.blade.php # Accessible progress indicators
|- accessibility/
   |- aria-live.blade.php    # Screen reader announcements
   |- focus-trap.blade.php   # Focus management
   |- language-switcher.blade.php # Session/cookie-based language switching
```

### 6.2 Core Data Models

#### Hybrid Authentication Component

```php
// HYBRID ARCHITECTURE - Four-Role RBAC System
// Roles: staff (portal access), approver (Grade 41+ approval), admin (operational), superuser (governance)

class User extends Authenticatable

    use Auditable;

    protected $fillable = [
        'name', 'email', 'password', 'role', 'staff_id', 'grade_id', 'division_id'
  ;

    // Four roles in the hybrid system
    public function isStaff(): bool
    
        return $this->role === 'staff';


    public function isApprover(): bool
    
        return $this->role === 'approver';


    public function isAdmin(): bool
    
        return $this->role === 'admin';


    public function isSuperuser(): bool
    
        return $this->role === 'superuser';


    // Relationships for authenticated users
    public function division(): BelongsTo
    
        return $this->belongsTo(Division::class);


    public function grade(): BelongsTo
    
        return $this->belongsTo(Grade::class);


    public function helpdeskTickets(): HasMany
    
        return $this->hasMany(HelpdeskTicket::class);


    public function loanApplications(): HasMany
    
        return $this->hasMany(LoanApplication::class);


    // Check if user can approve based on grade
    public function canApprove(): bool
    
        return $this->isApprover() || $this->isAdmin() || $this->isSuperuser();


```

#### Hybrid Helpdesk Module Component

```php
// Helpdesk Ticket Model - Supports both guest and authenticated submissions
class HelpdeskTicket extends Model

    use Auditable;

    protected $fillable = [
        'ticket_number', 'user_id', 'guest_name', 'guest_email', 'guest_phone',
        'staff_id', 'division_id', 'category_id', 'priority', 'subject',
        'description', 'status', 'assigned_to_division', 'assigned_to_agency',
        'asset_id', 'admin_notes'
  ;

    protected $casts = [
        'created_at' => 'datetime',
        'resolved_at' => 'datetime',
        'assigned_at' => 'datetime',
  ;

    // HYBRID SUPPORT - Optional user relationship for authenticated submissions
    public function user(): BelongsTo
    
        return $this->belongsTo(User::class);


    public function division(): BelongsTo
    
        return $this->belongsTo(Division::class);


    public function category(): BelongsTo
    
        return $this->belongsTo(TicketCategory::class);


    public function asset(): BelongsTo
    
        return $this->belongsTo(Asset::class);


    public function assignedDivision(): BelongsTo
    
        return $this->belongsTo(Division::class, 'assigned_to_division');


    public function comments(): HasMany
    
        return $this->hasMany(HelpdeskComment::class);


    public function attachments(): HasMany
    
        return $this->hasMany(HelpdeskAttachment::class);


    // Check if ticket is from guest or authenticated user
    public function isGuestSubmission(): bool
    
        return is_null($this->user_id);


    // Get submitter name (guest or authenticated)
    public function getSubmitterNameAttribute(): string
    
        return $this->user ? $this->user->name : $this->guest_name;


    // Get submitter email (guest or authenticated)
    public function getSubmitterEmailAttribute(): string
    
        return $this->user ? $this->user->email : $this->guest_email;


    public function generateTicketNumber(): string
    
        return 'HD' . date('Y') . str_pad($this->id, 6, '0', STR_PAD_LEFT);


```

#### Hybrid Asset Loan Module Component

```php
// Loan Application Model - Supports both guest and authenticated submissions with dual approval paths
class LoanApplication extends Model

    use Auditable;

    protected $fillable = [
        'application_number', 'user_id', 'applicant_name', 'applicant_email', 'applicant_phone',
        'staff_id', 'grade_id', 'division_id', 'asset_id', 'purpose',
        'start_date', 'end_date', 'status', 'approver_id', 'approver_name', 'approver_email',
        'approval_token', 'token_expires_at', 'approval_remarks', 'approval_method'
  ;

    protected $casts = [
        'start_date' => 'date',
        'end_date' => 'date',
        'approved_at' => 'datetime',
        'rejected_at' => 'datetime',
        'token_expires_at' => 'datetime',
  ;

    // HYBRID SUPPORT - Optional user relationships for authenticated submissions
    public function user(): BelongsTo
    
        return $this->belongsTo(User::class);


    public function approver(): BelongsTo
    
        return $this->belongsTo(User::class, 'approver_id');


    // Check if application is from guest or authenticated user
    public function isGuestSubmission(): bool
    
        return is_null($this->user_id);


    // Generate approval token for email-based approval
    public function generateApprovalToken(): string
    
        $this->approval_token = Str::random(64);
        $this->token_expires_at = now()->addDays(7);
        $this->save();

        return $this->approval_token;


    // Validate approval token
    public function isTokenValid(string $token): bool
    
        return $this->approval_token === $token
            && $this->token_expires_at > now()
            && $this->status === 'pending_approval';


```

### 6.3 Dual Approval Workflow Service

```php
class DualApprovalService

    // Send approval request with DUAL options (email + portal)
    public function sendApprovalRequest(LoanApplication $application): void
    
        // Generate secure approval token for email-based approval
        $token = $application->generateApprovalToken();

        // Determine approver based on applicant grade and asset value
        $approver = ApprovalMatrix::getApproverByGrade($application->grade_id, $application->asset);

        // Try to find approver user account for portal-based approval
        $approverUser = User::where('email', $approver['email'])
            ->where('role', 'approver')
            ->first();

        // Update application with approver details
        $application->update([
            'approver_id' => $approverUser?->id,
            'approver_name' => $approver['name'],
            'approver_email' => $approver['email'],
      );

        // Send email with DUAL approval options
        Mail::to($approver['email'])->send(new LoanApprovalRequest($application, $token));


    // Email-based approval (no login required)
    public function processEmailApproval(string $token, bool $approved, ?string $remarks = null): array
    
        $application = LoanApplication::where('approval_token', $token)->firstOrFail();

        if (!$application->isTokenValid($token)) 
            return [
                'success' => false,
                'message' => 'This approval link has expired or is invalid.',
          ;
    

        $application->update([
            'status' => $approved ? 'approved' : 'rejected',
            'approved_at' => now(),
            'approval_remarks' => $remarks,
            'approval_token' => null,
            'approval_method' => 'email',
      );

        $this->sendApprovalNotifications($application, $approved);

        return ['success' => true];


    // Portal-based approval (login required)
    public function processPortalApproval(LoanApplication $application, User $approver, bool $approved, ?string $remarks = null): array
    
        if (!$approver->canApprove()) 
            return [
                'success' => false,
                'message' => 'You do not have permission to approve applications.',
          ;
    

        $application->update([
            'status' => $approved ? 'approved' : 'rejected',
            'approved_at' => now(),
            'approval_remarks' => $remarks,
            'approver_id' => $approver->id,
            'approval_token' => null,
            'approval_method' => 'portal',
      );

        $this->sendApprovalNotifications($application, $approved);

        return ['success' => true];


```

## 7. Data Design & Entity Relationships (Ref: `docs/D09_DATABASE_DOCUMENTATION.md`)

### 7.1 Entity Relationship Diagram

```mermaid
erDiagram
    USERS ||--o AUDIT_LOGS : performs
    USERS ||--o HELPDESK_TICKETS : submits
    USERS ||--o LOAN_APPLICATIONS : submits
    USERS ||--o LOAN_APPLICATIONS : approves
    USERS 
        id int PK
        name string
        email string
        password string
        role enum "staff,approver,admin,superuser"
        staff_id string
        grade_id int FK
        division_id int FK
        locale string "Language preference"


    HELPDESK_TICKETS o--|| USERS : submitted_by
    HELPDESK_TICKETS o--|| ASSETS : relates_to
    HELPDESK_TICKETS ||--o HELPDESK_COMMENTS : has
    HELPDESK_TICKETS o--|| CATEGORIES : belongs_to
    HELPDESK_TICKETS 
        id int PK
        ticket_number string
        user_id int FK "NULL for guest"
        guest_name string
        guest_email string
        guest_phone string
        staff_id string
        division_id int FK
        category_id int FK
        priority enum
        subject string
        description text
        status enum
        assigned_to_division int FK
        assigned_to_agency string
        asset_id int FK
        admin_notes text


LOAN_APPLICATIONS o--|| USERS : submitted_by
    LOAN_APPLICATIONS o--|| USERS : approved_by
    LOAN_APPLICATIONS o--|| ASSETS : requests
    LOAN_APPLICATIONS ||--o| ASSET_TRANSACTIONS : generates
    LOAN_APPLICATIONS 
        id int PK
        application_number string
        user_id int FK "NULL for guest"
        applicant_name string
        applicant_email string
        applicant_phone string
        staff_id string
        grade_id int FK
        division_id int FK
        asset_id int FK
        purpose text
        start_date date
        end_date date
        status enum
        approver_id int FK "NULL for email approval"
        approver_name string
        approver_email string
        approval_token string
        token_expires_at datetime
        approval_remarks text
        approval_method enum "email,portal"



    ASSETS o--|| ASSET_CATEGORIES : belongs_to
    ASSETS ||--o ASSET_TRANSACTIONS : involved_in

    ASSET_TRANSACTIONS 
        id int PK
        loan_application_id int FK
        asset_id int FK
        issued_at datetime
        returned_at datetime
        condition_issued enum
        condition_returned enum
        notes text


    DIVISIONS ||--o USERS : has
    GRADES ||--o USERS : has

### 7.2 Data Tables Summary
Below is a summary of key tables:

| Table | Purpose | Notable Fields |
|-------|---------|----------------|
| `users` | Authenticated staff accounts | `name`, `email`, `password`, `staff_id`, `grade`, `division`, `role` (staff/approver/admin/superuser) |
| `helpdesk_tickets` | Stores guest and authenticated submissions | `ticket_number`, `user_id` (nullable for guest), `submitter_*` (guest fields), `category_id`, `sla_minutes`, `status` |
| `helpdesk_comments` / `helpdesk_attachments` | Conversation trail and uploaded evidence | `comment_type`, `attachment_path`, `visibility`, `user_id` (nullable) |
| `loan_applications` | Core asset loan request (guest or authenticated) | `application_number`, `user_id` (nullable for guest), `requester_*` (guest fields), `requested_from`, `requested_to`, `status` |
| `loan_approvals` | Approval audit (email or portal-based) | `approver_email`, `approver_grade`, `approver_user_id` (nullable), `token_hash`, `decision_at`, `approval_method` (email/portal) |
| `loan_transactions` | Issuance/return ledger | `issued_by_admin_id`, `returned_by_admin_id`, `condition_notes` |
| `assets` / `asset_categories` | Inventory catalogue | `availability_status`, `maintenance_required` |
| `activity_log` / `loan_audits` | Immutable audit records | `event`, `properties`, `causer_type/id`, `ip_address`, `submission_type` (guest/authenticated/admin) |

**Hybrid data model rationale:**
- `user_id` fields are nullable to support both guest (no login) and authenticated submissions
- Guest submissions store submitter details in dedicated fields (`submitter_name`, `submitter_email`, etc.)
- Authenticated submissions link to `users` table via `user_id` and can pre-fill from user profile
- Approval records track both email-based (token_hash) and portal-based (approver_user_id) decisions
- Audit logs distinguish between guest, authenticated, and administrative actions for compliance

Relationships support both guest anonymity and authenticated user tracking while meeting traceability and PDPA retention rules (7-year retention for tickets/loans, 12 months for queue logs) as set out in `docs/D03_SOFTWARE_REQUIREMENTS_SPECIFICATION.md` section 257 (Ref: Requirements 5.2, 7.5, 9.5, 23.6).

## 8. Security, Privacy & Accessibility Controls

- **PDPA compliance:** PII limited to operational needs, encrypted at rest using AES-256 where mandated; access scoped via four-role RBAC policies and Filament guards. Data retention: 7 years for tickets/loans, 12 months for queue logs (Ref: `docs/D02_BUSINESS_REQUIREMENTS_SPECIFICATION.md` section NFR-PDPA; Requirements 5.2, 9.4).
- **Threat mitigation:** CSRF protection, signed URLs with time-limited tokens (7 days for approvals), throttling (60 req/min per IP for guest forms, 100 req/min for APIs), reCAPTCHA Enterprise, attachment virus scanning hooks, TLS 1.3+ for data in transit (Ref: `docs/D04_SOFTWARE_DESIGN_DOCUMENT.md` section 3.1.4; Requirements 9.4, 12.2).
- **Authentication & Authorization:**
  - Guest forms: No authentication, rate-limited and reCAPTCHA-protected
  - Authenticated portal: Laravel Breeze/Jetstream with password hashing, session management, CSRF protection
  - Admin panel: Four-role RBAC (staff, approver, admin, superuser) with multifactor for superuser
  - (Ref: Requirements 9.1, 9.3, 22.1, 23.1)
- **Auditability:** Every state change, approval decision, guest submission, and authenticated user action captured in immutable activity logs with timestamp accuracy within 1 second, exposed via dashboards for auditors with 7-year retention (`docs/D09_DATABASE_DOCUMENTATION.md` section A5; Requirements 5.5, 9.2, 9.5).
- **Accessibility:** WCAG 2.2 AA adherence for all interfaces (guest forms, authenticated portal, admin panel):
  - **Color contrast:** Minimum 4.5:1 for text, 3:1 for UI components using compliant palette
  - **Compliant color palette:** Primary #0056b3 (6.8:1), Success #198754 (4.9:1), Warning #ff8c00 (4.5:1), Danger #b50c0c (8.2:1)
  - **Deprecated colors removed:** Warning Yellow #F1C40F, Danger Red #E74C3C
  - **Focus indicators:** 3-4px outline with 2px offset and 3:1 contrast ratio minimum
  - **Touch targets:** Minimum 44Ã—44px for all interactive elements
  - **Semantic HTML:** Proper HTML5 elements (header, nav, main, footer) with ARIA landmarks
  - **Keyboard navigation:** All interactive elements accessible via keyboard with visible focus
  - **Screen reader support:** Proper ARIA attributes, labels, and announcements
  - **Bilingual content:** BM/EN toggles with language switcher on every page
  - (Ref: `docs/D12_UI_UX_DESIGN_GUIDE.md` section 5, `docs/D15_LANGUAGE_MS_EN.md`; Requirements 5.1, 6.1-6.5, 19.5, 20.5)

## 9. Integrations & Interfaces

- **Email gateway:** Primary communication channel for confirmations, approvals (with 7-day token validity), and reminders (48 hours before due, on due date, daily for overdue); templates localised in BM/EN with WCAG 2.2 AA compliance and compliant color palette (Ref: `docs/email-notification-system.md` section 4; Requirements 1.2, 1.4, 10.1, 10.4, 12.1-12.5, 18.1-18.2).
- **Language switcher architecture:** Session and cookie-based persistence for guest users (no database storage, no `users.locale` column). Resolution priority: Session â†’ Cookie â†’ Browser â†’ Fallback. Authenticated users can optionally store preference in profile for portal convenience, but guest forms remain session/cookie only (Ref: Requirements 20.1-20.5).
- **Optional HRMIS lookup:** Read-only service for staff metadata pre-population in guest forms, proxied through BPM integration layer, with caching and circuit breakers per `docs/D07_SYSTEM_INTEGRATION_PLAN.md` section 3.2 (Ref: Requirements 7.3).
- **Reporting exports:** Scheduled CSV/PDF/Excel reports generated via Filament actions with unified data from both helpdesk and asset loan modules, feeding into BPM's reporting repository with 50MB file size limit (Ref: `docs/reports/` guidelines; Requirements 3.6, 8.2, 8.5).

## 10. Non-Functional Requirements

- **Performance:** (Ref: Requirements 19.1-19.4)
  - **Core Web Vitals targets:** LCP <2.5s, FID <100ms, CLS <0.1, TTFB <600ms on all public pages
  - **Lighthouse scores:** Performance 90+, Accessibility 100, Best Practices 100, SEO 100
  - **Image optimization:** WebP format with JPEG fallbacks using picture elements, explicit width/height attributes, critical images with fetchpriority="high", non-critical images with loading="lazy" and fetchpriority="low"
  - **Asset optimization:** Vite configuration with Gzip/Brotli compression, code splitting with manual chunks for vendor/livewire, Terser minification with drop_console in production, correct TailwindCSS content paths for purging
  - **Inline styles refactoring:** All inline style attributes and style blocks refactored into external CSS files imported via Vite
  - **Monitoring:** Automated performance monitoring with alerts when Core Web Vitals thresholds exceeded
  - Monitored via Lighthouse profiles (`docs/performance-optimization-report.md` section 2)
- **Scalability:** Horizontal scalability achieved through stateless web nodes and centralised Redis/MySQL instances (Ref: `docs/D04_SOFTWARE_DESIGN_DOCUMENT.md` section 3.2).
- **Resilience:** Queue retry policies (3 attempts with exponential backoff), idempotent service methods, and fallback messaging paths documented in `docs/D08_SYSTEM_INTEGRATION_SPECIFICATION.md` section 4 (Ref: Requirements 10.2).
- **Observability:** Structured logging, queue metrics, real-time monitoring (60-second intervals for performance metrics, 300-second refresh for dashboards), and optional Sentry integration give operations visibility (`docs/D11_TECHNICAL_DESIGN_DOCUMENTATION.md` section 7; Requirements 8.3).
- **Browser compatibility:** Chrome 90+, Firefox 88+, Safari 14+, Edge 90+ (Chromium) with automated cross-browser validation (Ref: Requirements 23.5).

## 11. Component Compliance & Quality Assurance

- **Frontend component auditing:** (Ref: Requirements 16.1-16.5, 17.1-17.5, 18.1-18.5)
  - Systematic review of all Blade templates, Livewire components, Volt components, email templates, error pages, and Filament admin interfaces against D03-D15 standards
  - Comprehensive compliance reports identifying gaps in accessibility, documentation, branding, performance, metadata, and requirements traceability
  - Findings categorized by severity (critical, high, medium, low) and compliance area
  - Existing compliant components used as reference standards for validation
- **Component metadata standards:**
  - Standardized header comments with name, description, author, trace references to D00-D15 standards, and timestamps
  - Links to specific D03 software requirements and D04 design specifications
  - Documentation of accessibility features, supported browsers, and WCAG 2.2 compliance level
  - Usage examples and integration guidelines per D10 documentation standards
  - Version history and change tracking per D11 specifications
- **Email template compliance:**
  - WCAG 2.2 Level AA accessibility with proper semantic HTML and compliant color contrast ratios
  - MOTAC branding and bilingual support per D14 and D15 standards using compliant color palette
  - Proper metadata, documentation, and testing procedures per D10 and D11 standards
- **Error page compliance:**
  - Accessible, helpful, and branded user experiences with proper ARIA attributes and semantic structure
  - Bilingual support and proper navigation
  - Standardized metadata and documentation
- **Filament admin interface compliance:**
  - D00-D15 standards for accessibility, documentation, and branding
  - Compliant colors and WCAG 2.2 Level AA requirements
  - Documentation for accessibility features

## 12. Testing & Quality Assurance

- **Test suites:** PHPUnit 11 feature and unit tests cover ticket creation, loan approvals, notifications, Livewire interactions, authenticated portal features, and dual approval workflows (Ref: `docs/testing/testing-and-quality-assurance-summary.md` section 3).
- **Coverage targets:** >=80% overall business logic, >=95% for guest submission, authenticated portal, and approval flows (`docs/D03_SOFTWARE_REQUIREMENTS_SPECIFICATION.md` section Test Coverage).
- **Accessibility & UX checks:** Automated Axe/Lighthouse scans plus manual keyboard and screen-reader sweeps each sprint, targeting Lighthouse scores of Performance 90+, Accessibility 100 (`docs/testing/user-acceptance-testing-guide.md` section 4; Requirements 19.2).
- **Performance testing:** Core Web Vitals monitoring with automated alerts, Lighthouse CI integration, and cross-browser compatibility testing (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+) (Ref: Requirements 19.1-19.2, 23.5).
- **Deployment gates:** Larastan (level set in `phpstan.neon`) and Pint formatting run pre-merge to enforce coding standards (`docs/D10_SOURCE_CODE_DOCUMENTATION.md`).

## 13. Traceability Snapshot

| Capability | Design Artefacts | D-Doc Reference | Requirements |
|------------|------------------|-----------------|--------------|
| Hybrid architecture (guest + authenticated + admin) | section 1, section 2.1-2.2 | `docs/D00_SYSTEM_OVERVIEW.md`, `docs/D04_SOFTWARE_DESIGN_DOCUMENT.md` | 1.1, 22.1, 23.1 |
| Helpdesk submissions & SLA tracking | section 5.1, section 7 | `docs/D03_SOFTWARE_REQUIREMENTS_SPECIFICATION.md` SRS-HELP, `docs/helpdesk-system-flow.md` | 1.1-1.3, 11.1-11.7, 13.1-13.5 |
| Asset loan approvals & inventory | section 5.2, section 7 | `docs/D03_SOFTWARE_REQUIREMENTS_SPECIFICATION.md` SRS-LOAN, `docs/asset-loan-system-flow.md` | 1.4-1.6, 12.1-12.5 |
| Authenticated internal portal | section 5.4 | `docs/D04_SOFTWARE_DESIGN_DOCUMENT.md` | 22.1-22.7, 23.3 |
| Four-role RBAC & admin governance | section 5.3, section 8 | `docs/D04_SOFTWARE_DESIGN_DOCUMENT.md` section 4.3, `docs/D09_DATABASE_DOCUMENTATION.md` | 3.1-3.7, 9.1 |
| Dual approval workflows (email + portal) | section 6.3, section 5.2 | `docs/email-notification-system.md` | 1.6, 12.1-12.5, 23.2 |
| Accessibility & compliant color palette | section 3, section 3.1 | `docs/D12_UI_UX_DESIGN_GUIDE.md`, `docs/D14_UI_UX_STYLE_GUIDE.md`, `docs/D15_LANGUAGE_MS_EN.md` | 5.1, 6.1-6.5, 19.5, 20.5 |
| Performance & Core Web Vitals | section 4 | `docs/performance-optimization-report.md` | 19.1-19.4 |
| Component compliance & auditing | section 8, section 11 | `docs/D10_SOURCE_CODE_DOCUMENTATION.md`, `docs/D12_UI_UX_DESIGN_GUIDE.md` | 16.1-16.5, 17.1-17.5, 18.1-18.5 |
| Language switcher (session/cookie only) | section 6.1 | `docs/D15_LANGUAGE_MS_EN.md` | 20.1-20.5 |
| Guest form optimization | section 4, section 6.1 | `docs/D13_UI_UX_FRONTEND_FRAMEWORK.md` | 21.1-21.5 |
| Quality assurance & testing | section 12 | `docs/testing/testing-and-quality-assurance-summary.md` | All requirements |

This design document remains within repository scope and reflects the current approved architecture with hybrid access model (guest + authenticated portal + admin panel). Any changes that alter these design commitments must be cross-referenced with the relevant D00-D15 artefacts and routed through the D01 section 9.3 approval workflow.
// Roles: staff (portal access), approver (Grade 41+ approval), admin (operational), superuser (governance)

class User extends Authenticatable

    use Auditable;

    protected $fillable = [
        'name', 'email', 'password', 'role', 'staff_id', 'grade_id', 'division_id'
  ;

    // Four roles in the hybrid system
    public function isStaff(): bool
    
        return $this->role === 'staff';


    public function isApprover(): bool
    
        return $this->role === 'approver';


    public function isAdmin(): bool
    
        return $this->role === 'admin';


    public function isSuperuser(): bool
    
        return $this->role === 'superuser';


    // Relationships for authenticated users
    public function division(): BelongsTo
    
        return $this->belongsTo(Division::class);


    public function grade(): BelongsTo
    
        return $this->belongsTo(Grade::class);


    public function helpdeskTickets(): HasMany
    
        return $this->hasMany(HelpdeskTicket::class);


    public function loanApplications(): HasMany
    
        return $this->hasMany(LoanApplication::class);


    // Check if user can approve based on grade
    public function canApprove(): bool
    
        return $this->isApprover() || $this->isAdmin() || $this->isSuperuser();


```

#### Supplementary: Hybrid Helpdesk Module Component (expanded)

```php
// Helpdesk Ticket Model - Supports both guest and authenticated submissions
class HelpdeskTicket extends Model

    use Auditable;

    protected $fillable = [
        'ticket_number', 'user_id', 'guest_name', 'guest_email', 'guest_phone',
        'staff_id', 'division_id', 'category_id', 'priority', 'subject',
        'description', 'status', 'assigned_to_division', 'assigned_to_agency',
        'asset_id', 'admin_notes'
  ;

    protected $casts = [
        'created_at' => 'datetime',
        'resolved_at' => 'datetime',
        'assigned_at' => 'datetime',
  ;

    // HYBRID SUPPORT - Optional user relationship for authenticated submissions
    public function user(): BelongsTo
    
        return $this->belongsTo(User::class);


    public function division(): BelongsTo
    
        return $this->belongsTo(Division::class);


    public function category(): BelongsTo
    
        return $this->belongsTo(TicketCategory::class);


    public function asset(): BelongsTo
    
        return $this->belongsTo(Asset::class);


    public function assignedDivision(): BelongsTo
    
        return $this->belongsTo(Division::class, 'assigned_to_division');


    public function comments(): HasMany
    
        return $this->hasMany(HelpdeskComment::class);


    public function attachments(): HasMany
    
        return $this->hasMany(HelpdeskAttachment::class);


    // Check if ticket is from guest or authenticated user
    public function isGuestSubmission(): bool
    
        return is_null($this->user_id);


    // Get submitter name (guest or authenticated)
    public function getSubmitterNameAttribute(): string
    
        return $this->user ? $this->user->name : $this->guest_name;


    // Get submitter email (guest or authenticated)
    public function getSubmitterEmailAttribute(): string
    
        return $this->user ? $this->user->email : $this->guest_email;


    public function generateTicketNumber(): string
    
        return 'HD' . date('Y') . str_pad($this->id, 6, '0', STR_PAD_LEFT);


```

#### Supplementary: Hybrid Asset Loan Module Component (expanded)

```php
// Loan Application Model - Supports both guest and authenticated submissions with dual approval paths
class LoanApplication extends Model

    use Auditable;

    protected $fillable = [
        'application_number', 'user_id', 'applicant_name', 'applicant_email', 'applicant_phone',
        'staff_id', 'grade_id', 'division_id', 'asset_id', 'purpose',
        'start_date', 'end_date', 'status', 'approver_id', 'approver_name', 'approver_email',
        'approval_token', 'token_expires_at', 'approval_remarks', 'approval_method'
  ;

    protected $casts = [
        'start_date' => 'date',
        'end_date' => 'date',
        'approved_at' => 'datetime',
        'rejected_at' => 'datetime',
        'token_expires_at' => 'datetime',
  ;

    // HYBRID SUPPORT - Optional user relationships for authenticated submissions
    public function user(): BelongsTo
    
        return $this->belongsTo(User::class);


    public function approver(): BelongsTo
    
        return $this->belongsTo(User::class, 'approver_id');


    public function division(): BelongsTo
    
        return $this->belongsTo(Division::class);


    public function grade(): BelongsTo
    
        return $this->belongsTo(Grade::class);


    public function asset(): BelongsTo
    
        return $this->belongsTo(Asset::class);


    public function transaction(): HasOne
    
        return $this->hasOne(AssetTransaction::class);


    // Check if application is from guest or authenticated user
    public function isGuestSubmission(): bool
    
        return is_null($this->user_id);


    // Get applicant name (guest or authenticated)
    public function getApplicantNameAttribute(): string
    
        return $this->user ? $this->user->name : $this->attributes['applicant_name'];


    // Get applicant email (guest or authenticated)
    public function getApplicantEmailAttribute(): string
    
        return $this->user ? $this->user->email : $this->attributes['applicant_email'];


    // Generate approval token for email-based approval
    public function generateApprovalToken(): string
    
        $this->approval_token = Str::random(64);
        $this->token_expires_at = now()->addDays(7);
        $this->save();

        return $this->approval_token;


    // Validate approval token
    public function isTokenValid(string $token): bool
    
        return $this->approval_token === $token
            && $this->token_expires_at > now()
            && $this->status === 'pending_approval';


    // Generate application number
    public function generateApplicationNumber(): string
    
        return 'AL' . date('Y') . str_pad($this->id, 6, '0', STR_PAD_LEFT);


```

### 6.1 Frontend Component Architecture (Supplementary Listing)

#### 1. WCAG 2.2 AA Compliant Component Library Structure

```
resources/views/components/
â”œâ”€â”€ layout/
â”‚   â”œâ”€â”€ guest.blade.php        # Guest layout for public forms (no authentication)
â”‚   â”œâ”€â”€ app.blade.php          # Authenticated layout for staff portal (login required)
â”‚   â”œâ”€â”€ header.blade.php       # Site header with MOTAC branding
â”‚   â”œâ”€â”€ auth-header.blade.php  # Authenticated header with user menu
â”‚   â””â”€â”€ footer.blade.php       # Site footer with accessibility links
â”œâ”€â”€ form/
â”‚   â”œâ”€â”€ input.blade.php        # WCAG compliant input with proper labels
â”‚   â”œâ”€â”€ select.blade.php       # Accessible select with ARIA attributes
â”‚   â”œâ”€â”€ textarea.blade.php     # Accessible textarea component
â”‚   â”œâ”€â”€ checkbox.blade.php     # WCAG compliant checkbox
â”‚   â””â”€â”€ file-upload.blade.php  # Accessible file upload component
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ button.blade.php       # 44Ã—44px minimum touch targets
â”‚   â”œâ”€â”€ card.blade.php         # Accessible card container
â”‚   â”œâ”€â”€ alert.blade.php        # ARIA live region alerts
â”‚   â”œâ”€â”€ badge.blade.php        # Accessible status badges
â”‚   â””â”€â”€ modal.blade.php        # Focus trap modal dialogs
â”œâ”€â”€ navigation/
â”‚   â”œâ”€â”€ breadcrumbs.blade.php  # Accessible breadcrumb navigation
â”‚   â”œâ”€â”€ pagination.blade.php   # WCAG compliant pagination
â”‚   â””â”€â”€ skip-links.blade.php   # Skip navigation for keyboard users
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ table.blade.php        # Accessible data tables
â”‚   â”œâ”€â”€ status-badge.blade.php # Color + icon + text status indicators
â”‚   â””â”€â”€ progress-bar.blade.php # Accessible progress indicators
â””â”€â”€ accessibility/
    â”œâ”€â”€ aria-live.blade.php    # Screen reader announcements
    â”œâ”€â”€ focus-trap.blade.php   # Focus management
    â””â”€â”€ language-switcher.blade.php # Session/cookie-based language switching
```

### 7.3 Additional ERD View

```mermaid
erDiagram
    USERS ||--o AUDIT_LOGS : performs
    USERS ||--o HELPDESK_TICKETS : submits
    USERS ||--o LOAN_APPLICATIONS : submits
    USERS ||--o LOAN_APPLICATIONS : approves
    USERS 
        id int PK
        name string
        email string
        password string
        role enum "staff,approver,admin,superuser"
        staff_id string
        grade_id int FK
        division_id int FK
        locale string "Language preference"


    HELPDESK_TICKETS o--|| USERS : submitted_by
    HELPDESK_TICKETS o--|| ASSETS : relates_to
    HELPDESK_TICKETS ||--o HELPDESK_COMMENTS : has
    HELPDESK_TICKETS o--|| CATEGORIES : belongs_to
    HELPDESK_TICKETS 
        id int PK
        ticket_number string
        user_id int FK "NULL for guest"
        guest_name string
        guest_email string
        guest_phone string
        staff_id string
        division_id int FK
        category_id int FK
        priority enum
        subject string
        description text
        status enum
        assigned_to_division int FK
        assigned_to_agency string
        asset_id int FK
        admin_notes text


    LOAN_APPLICATIONS o--|| USERS : submitted_by
    LOAN_APPLICATIONS o--|| USERS : approved_by
    LOAN_APPLICATIONS o--|| ASSETS : requests
    LOAN_APPLICATIONS ||--o| ASSET_TRANSACTIONS : generates
    LOAN_APPLICATIONS 
        id int PK
        application_number string
        user_id int FK "NULL for guest"
        applicant_name string
        applicant_email string
        applicant_phone string
        staff_id string
        grade_id int FK
        division_id int FK
        asset_id int FK
        purpose text
        start_date date
        end_date date
        status enum
        approver_id int FK "NULL for email approval"
        approver_name string
        approver_email string
        approval_token string
        token_expires_at datetime
        approval_remarks text
        approval_method enum "email,portal"


    ASSETS o--|| ASSET_CATEGORIES : belongs_to
    ASSETS ||--o ASSET_TRANSACTIONS : involved_in

    ASSET_TRANSACTIONS 
        id int PK
        loan_application_id int FK
        asset_id int FK
        issued_at datetime
        returned_at datetime
        condition_issued enum
        condition_returned enum
        notes text


    DIVISIONS ||--o USERS : has
    GRADES ||--o USERS : has

    AUDIT_LOGS o--|| USERS : performed_by
```

This design document remains within repository scope and reflects the current approved architecture with hybrid access model (guest + authenticated portal + admin panel). Any changes that alter these design commitments must be cross-referenced with the relevant D00-D15 artefacts and routed through the D01 section 9.3 approval workflow.

